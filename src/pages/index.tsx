import Head from "next/head";
import Header from "@/components/Header";
import styles from "../styles/style.module.scss";
import Timeline from "@/components/Timeline";
import Post from "@/components/Post";
import { useEffect, useState } from "react";
import apiClient from "@/lib/apiClient";
import { useRouter } from "next/navigation"; // è¿½åŠ 
import Footer from "@/components/Footer";

export type User = {
  id: number;
  username: string;
  email: string;
  password: string;
};

export type Post = {
  id: number;
  content: string;
  createdAt: string;
  authorId: number;
  author: User;
};

export default function Home() {
  // useStateã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ğŸ¤—
  const [posts, setPosts] = useState<Post[]>([]);
  const router = useRouter(); //  ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’å–å¾—

  // useEffectã®å‡¦ç†=ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸç›´å¾Œã«ï¼‘åº¦å®Ÿè¡Œã•ã‚Œã¾ã™ğŸ¤—
  useEffect(() => {
    // ã“ã“ã«è¿½åŠ ã™ã‚‹ï¼
    const token = localStorage.getItem("token");
    if (!token) {
      router.push("/login"); // ãƒˆãƒ¼ã‚¯ãƒ³ãŒãªã‘ã‚Œã°ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸
      return;
    }
    // ã“ã“ã«è¿½åŠ ã™ã‚‹ï¼

    const fetchPosts = async () => {
      try {
        const response = await apiClient.get("/api/posts");
        console.log(response, "response"); //å–å¾—ã§ãã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¾ã—ã‚‡ã†ğŸ¤—
        setPosts(response.data);
      } catch (error) {
        console.error("æŠ•ç¨¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
      }
    };

    fetchPosts();
  }, [router]);

  // è¿½åŠ 
  console.log(posts, "ãƒ‡ãƒ¼ã‚¿");

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.container}>
        {/*  */}
        {/* å…ˆã»ã©ä½œæˆã—ãŸHeaderã®ãƒ‘ãƒ¼ãƒ„ã‚’å‘¼ã³å‡ºã™è¨˜è¿°ã‚’æ›¸ãã¾ã™ğŸ¤— */}
        <Header />

        <Timeline setPosts={setPosts} />

        {/* å¾Œã§æ¶ˆã—ã¾ã™ãŒå…ˆã«è¡¨ç¤ºã®ç¢ºèªã‚’ã—ã¾ã—ã‚‡ã†ğŸ¤— */}
        {/* <Button textColor="pink" bg="blue" /> */}

        {/* è¡¨ç¤ºã™ã‚‹æ™‚ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ğŸ¤— */}
        {posts.map((item, index) => (
          <Post
            key={index}
            content={item.content}
            createdAt={item.createdAt}
            author={item.author}
          />
        ))}
        {/*  */}

        <Footer />
      </main>
    </>
  );
}